<table class="table table-bordered">
    <thead>
    <tr>
        <th rowspan="2">No.</th>
        <th rowspan="2">{{ __('swal.case_no') }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th rowspan="2">{{ __('form1.claimant_name') }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th rowspan="2">{{ __('new.opponent_name') }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        {{--        <th rowspan="2">{{ __('form1.filing_date') }} B1</th>--}}
        <th colspan="2">Jenis Tuntutan</th>
        <th colspan="4">Tarikh Borang Difailkan</th>
        {{--        <th rowspan="2">B4</th>--}}
        <th colspan="8" style="background:honeydew">{{ __('form4.list_hearing') }}</th>
        <th colspan="9">Tarikh Award</th>
        <th rowspan="2">{{ __('form1.amount_claim') }}</th>
        <th rowspan="2">{{ __('new.award_value') }}</th>
        <th rowspan="2">{{ __('hearing.president_name') }}</th>
        <th rowspan="2">KPI 60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        {{--        <th colspan="6" style="background: aliceblue">{{ __('new.award') }}</th>--}}
        <th rowspan="2">KPI 60 (+/-)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th rowspan="2">B12</th>
        <th colspan="4">{{ __('form4.list_hearing') }}</th>
        <th rowspan="2">Tarikh TB/NH</th>
        <th rowspan="2">Tarikh KPA</th>
        <th rowspan="2">Semakan Kehakkim</th>
        <th rowspan="2">Endorsement (S117)</th>
        <th rowspan="2">Catatan</th>
    </tr>
    <tr>
        <th style="background:honeydew">Jenis Tuntutan (B/P)</th>
        <th style="background:honeydew">Klasifikasi</th>

        <th style="background:honeydew">B1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">B2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">B3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">B4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>

        <th style="background:honeydew">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background:honeydew">8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>

        <th style="background: aliceblue">B5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B10K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B10T&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th style="background: aliceblue">B10B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>

        <th>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        <th>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
    </tr>
    </thead>
    <tbody>
    @if(count($data_final) > 0)
        @foreach($data_final as $key => $datum)
            @php
                $b12_status = false;
                $tb_status = false;
                $nh_status = $datum->stop_notice ? true : false;
                $b_status = false;
                $award_b5_date = '';
                $award_b6_date = '';
                $award_b7_date = '';
                $award_b8_date = '';
                $award_b9_date = '';
                $award_b10_date = '';
                $award_b10k_date = '';
                $award_b10t_date = '';
                $award_b10b_date = '';
                $award_value = '';
                $kpi = '';
            @endphp
            <tr>
                <td>{{ $key+1 }}</td>
                <td>{{ $datum->case_no }}</td>
                <td>{{ $datum->claimant_address->name }}</td>
                <td>
                    <ol>
                        @foreach($datum->multiOpponents as $i => $cco)
                            <li>{{$cco->opponent_address->name}}</li>
                        @endforeach
                    </ol>
                </td>
                <td>{{ $datum->form1->classification ? ($datum->form1->classification->category_id == 1 ? 'B' : 'P') : '-' }}</td>
                <td>{{ $input['locale'] == 'en' ? $datum->form1->classification->classification_en : $datum->form1->classification->classification_my }}</td>
                <td>{{ \Carbon\Carbon::parse($datum->form1->filing_date)->format('d/m/Y') }}</td>
                <td style="background: aliceblue">
                    <ol>
                        @foreach($datum->multiOpponents as $i => $cco)
                            <li>{{$cco->form2 ? $cco->form2->created_at->format('d/m/Y') : '-'}}</li>
                        @endforeach
                    </ol>
                </td>
                <td style="background: aliceblue">
                    <ol>
                        @foreach($datum->multiOpponents as $i => $cco)
                            <li>{{($cco->form2 && $cco->form2->form3) ? $cco->form2->form3->created_at->format('d/m/Y') : '-'}}</li>
                        @endforeach
                    </ol>
                </td>
                <td style="background: aliceblue">
                    <ol>
                        <?php $f4_cco = 0; ?>
                        @foreach($datum->multiOpponents as $i => $cco)
                            @if($f4_cco == 0 && count($cco->form4) > 0)
                                {{ $cco->form4[0]->hearing->hearing_date }}
                                <?php $f4_cco = 1; ?>
                            @endif
                        @endforeach
                    </ol>
                </td>
                {{--                <td style="background: aliceblue">{{ $award_b3_date != '' ? \Carbon\Carbon::parse($award_b8_date)->format('d/m/Y') : '' }}</td>--}}
                {{--                <td style="background: aliceblue">{{ $award_b4_date != '' ? \Carbon\Carbon::parse($award_b8_date)->format('d/m/Y') : '' }}</td>\--}}

                {{--                <td style="text-align: right">{{ $datum->form1->claim_amount }}</td>--}}
                {{--                <td>{{ isset($datum->form4[0]) ? \Carbon\Carbon::parse($datum->form4[0]->created_at)->format('d/m/Y') : '-' }}</td>--}}
                @for($i = 0; $i < 8; $i++)
                    <td style="background:honeydew">{{ isset($datum->form4[$i]) ? \Carbon\Carbon::parse($datum->form4[$i]->hearing->hearing_date)->format('d/m/Y') : '' }}</td>
                    @if(isset($datum->form4[$i]))
                        @php
                            $b12_status = ($b12_status == true || $datum->form4[$i]->form12_id != null) ? true : false;
                            $tb_status = ($tb_status == true || $datum->form4[$i]->hearing_position_id == 6) ? true : false;
                            $b_status = ($b_status == true || $datum->form4[$i]->hearing_position_id == 4) ? true : false;
                            $award_b5_date = ($award_b5_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 5) ? $datum->form4[$i]->award->award_date : $award_b5_date);
                            $award_b6_date = ($award_b6_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 6) ? $datum->form4[$i]->award->award_date : $award_b6_date);
                            $award_b7_date = ($award_b7_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 7) ? $datum->form4[$i]->award->award_date : $award_b7_date);
                            $award_b8_date = ($award_b8_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 8) ? $datum->form4[$i]->award->award_date : $award_b8_date);
                            $award_b9_date = ($award_b9_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 9) ? $datum->form4[$i]->award->award_date : $award_b9_date);
                            $award_b10_date = ($award_b10_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 10) ? $datum->form4[$i]->award->award_date : $award_b10_date);
                            $award_b10k_date = ($award_b10k_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 10 && $datum->form4[$i]->award->f10_type_id == 1) ? $datum->form4[$i]->award->award_date : $award_b10k_date);
                            $award_b10t_date = ($award_b10t_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 10 && $datum->form4[$i]->award->f10_type_id == 3) ? $datum->form4[$i]->award->award_date : $award_b10t_date);
                            $award_b10b_date = ($award_b10b_date == '' && ($datum->form4[$i]->award_id != null && $datum->form4[$i]->award->award_type == 10 && $datum->form4[$i]->award->f10_type_id == 4) ? $datum->form4[$i]->award->award_date : $award_b10b_date);
                            $award_value = ($award_value == '' && ($datum->form4[$i]->award_id != null) ? $datum->form4[$i]->award->award_value : $award_value);
                            // $kpi = ($kpi == '' && ($datum->form4[$i]->award_id != null) ? (\Carbon\Carbon::parse($datum->form1->filing_date)->diffInDays(\Carbon\Carbon::parse($datum->form4[$i]->award->award_date))) : $kpi);
                            $kpi = ($kpi == '' && ($datum->form4[$i]->award_id != null) ? (\Carbon\Carbon::parse($datum->form4[$i]->award->award_date)->diffInDays(\Carbon\Carbon::parse($datum->form1->filing_date))) : $kpi);
                        @endphp
                    @endif
                @endfor
                <td style="background: aliceblue">{{ $award_b5_date != '' ? \Carbon\Carbon::parse($award_b5_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b6_date != '' ? \Carbon\Carbon::parse($award_b6_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b7_date != '' ? \Carbon\Carbon::parse($award_b7_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b8_date != '' ? \Carbon\Carbon::parse($award_b8_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b9_date != '' ? \Carbon\Carbon::parse($award_b9_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b10_date != '' ? \Carbon\Carbon::parse($award_b10_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b10k_date != '' ? \Carbon\Carbon::parse($award_b10k_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b10t_date != '' ? \Carbon\Carbon::parse($award_b10t_date)->format('d/m/Y') : '' }}</td>
                <td style="background: aliceblue">{{ $award_b10b_date != '' ? \Carbon\Carbon::parse($award_b10b_date)->format('d/m/Y') : '' }}</td>
                <td style="text-align: right">{{ $datum->form1->claim_amount }}</td>
                <td style="text-align: right">{{ $award_value }}</td>
                <td>
                    <?php $f4_cco = 0; ?>
                    @foreach($datum->multiOpponents as $i => $cco)
                        @if($f4_cco == 0)
                            <?php
                            $last_f4 = $cco->form4()
                                ->where('hearing_status_id', 1)
                                ->orderBy('form4_id', 'desc')
                                ->first();
                            ?>
                            @if($last_f4)
                                {{ $last_f4->president_user_id != null
                                    ? $last_f4->president->name
                                    : (
                                        $last_f4->hearing->president_user_id != null
                                        ? $last_f4->hearing->president->name
                                        : '-'
                                    ) }}
                                <?php $f4_cco = 1; ?>
                            @endif
                        @endif
                    @endforeach
                </td>
                <td>{{$kpi}}</td>
                <td>{{(is_integer($kpi) ? (60 - $kpi) : '')}}</td>
                <td>{{ $b12_status ? __('new.s_yes') : __('new.s_no') }}</td>
                @php
                    $b12_hearings = $datum->form4()->whereNotNull('form12_id')->limit(3)->get();
                @endphp
                @for($i = 0; $i < 4; $i++)
                    <td>{{ isset($b12_hearings[$i]) ? \Carbon\Carbon::parse($b12_hearings[$i]->hearing->hearing_date)->format('d/m/Y') : '' }}</td>
                @endfor
                <td>{{ ($nh_status || $tb_status) ? __('new.s_yes') : __('new.s_no') }}</td>
                <td>{{ $b_status ? __('new.s_yes') : __('new.s_no') }}</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        @endforeach
    @else
        <tr>
            <td colspan="17">
                Tiada maklumat dijumpai
            </td>
        </tr>
    @endif
    </tbody>
</table>
